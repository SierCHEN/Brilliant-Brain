---
title: responsive-system
author:
createTime: 2024/08/06 14:04:13
permalink: /article/qvfkx082/
---

# 响应系统

:::tip 思考
在介绍响应式之前，我们先来思考一个问题，**什么是响应式？为什么需要响应式？**

**Vue**的官网这样解释道：“**Vue**能够**拦截**对响应式对象所有属性的**访问**和**修改**，以便进行**依赖追踪**和**触发更新**。”于是当某一数据（对象）具有响应式时，它的变化是可以**被检测到**，并**对这种变化做出响应机制**，比如通知依赖它的系统。这就是`数据响应式`。

这里我们先两个提出概念，`数据` 和 `工具`。你可以简单地把 `数据` 理解为**基本类型**，比如说字符串、数字等（是否可以认为，除字符串和数字之外的其他基本类型，都可以归为这两类，比如说布尔值，可以用数字0和1表示），而 `工具` ，可以理解为**对象**。所谓的 `响应式` ，其实就是利用 `工具` ，对 `数据` 进行监测，并将监测的结果通知依赖该数据的系统。`工具` 提供了这些方法，我们可以发现，**对象**就是如此，**对象**内部封装了[[Get]]、[[Set]]方法，向外部暴露了监听对象内部数据的方法，而我们真正所监听的，是对象内部的那些 `数据` ，例如obj.foo。

正因为如此，也解释了为什么Proxy是一个对象，它代理了一个对象，因为Proxy本质上，是一种 `工具` 。

## “桶”的实现
我们用`WeakMap`、`Map`和`Set`构造了这个“桶”，其中`WeakMap`的键是原始对象 **target**，`WeakMap`的值是一个`Map`实例，而`Map`的键是原始对象 **target** 的 **key**，`Map`的值是一个由副作用函数组成的`Set`。